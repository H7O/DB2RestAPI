# Database-to-Rest API

This is a sample solution that shows how to create a REST API from a database with DB-first approach.

All you need to have is knowledge in writing SQL queries and you'll hopefully be on your way building safe and secure REST APIs in minutes.

You can expand on this solution to add more features like authentication, authorization, logging, etc..

However, for public APIs or B2B APIs with API keys, you can use this solution as is. You'll be surprised how easy it is to build a REST API from a database using this approach.

## How to use

1. Create a sample database and name it `test`, then run the SQL script below to create a sample `phone_book` table within the `test` database that you just created.

> **Note**: Download and install either SQL Server Developer Edition or SQL Server Express if you don't have SQL Server installed on your machine

```sql
CREATE TABLE [dbo].[phone_book] (
    [id]    UNIQUEIDENTIFIER CONSTRAINT [DEFAULT_phone_book_id] DEFAULT (newid()) NOT NULL,
    [name]  NVARCHAR (500)   NULL,
    [phone] NVARCHAR (100)   NULL,
    CONSTRAINT [PK_phone_book] PRIMARY KEY CLUSTERED ([id] ASC)
);
```

1. Clone this repository.
1. Open the solution in Visual Studio.
1. Open the `/config/settings.xml` file and change the default `ConnectionStrings` to point to your `test` database.
1. Run the solution.
1. Download and install [Postman](https://www.postman.com/downloads/).
1. Open Postman and create a new request.
1. Set the request method to `POST` (or `GET`).
1. Set the request URL to `http://localhost:<your_custom_port>/hello_world`.
1. Fill `Content-Type` header with `application/json`.
1. Fill the request body with the following JSON:

```json
{
	"name": "John",
}
```
1. Send the request and you should see the following JDON respons: 
```json

[
    {
        "message_from_db": "hello John!"
    }
]
```
1. To see how the API works, change the `name` property in the request body to `Jane` and send the request again. You should see a different response from the database.
1. To see the SQL query that generated the response, open the `/config/sql.xml` file and look for the `hello_world` query. You can change the query to anything you want and the API will still work as long as the query is valid and returns at least a single row.
1. If you examine the `hello_world` query in `/config/sql.xml`, you'll find the use of the `{{name}}` parameter. This parameter is passed from the request body to the query. You can add as many parameters as you want and use them in your queries.
```sql
declare @name nvarchar(500) = {{name}};
        
if (@name is null or @name = '')
begin
    set @name = 'world';
end
select 'hello ' + @name + '!' as message_from_db;
```
1. Passing parameters are safe and secure. The solution is designed to protect against SQL injection attacks by default by utilizing SQL Server's built-in parameterization feature. 
> **Note**: The SQL parameterization feature is offered by github library [Com.H.Data.Common](https://github.com/H7O/Com.H.Data.Common) available as Nuget package at [Com.H.Data.Common](https://www.nuget.org/packages/Com.H.Data.Common/).


## Phonebook API examples
Now, let's try to create a new record in the `phone_book` table. 
1. To do that, change the request URL to `http://localhost:<your_custom_port>/add_contact` and change the request method to `POST`.
1. Fill `Content-Type` header with `application/json`.
1. Fill the request body with the following JSON:
```json
{
	"name": "John",
	"phone": "1234567890"
}
```
1. Send the request and you should see the following JDON respons: 
```json
[
	{
		"id": "b0b0b0b0-b0b0-b0b0-b0b0-b0b0b0b0b0b0",
		"name": "John",
		"phone": "1234567890"
	}
]
```
> **Note**: The `id` property is generated by the database and returned by the API. You can use this `id` to update or delete the record later.
> The `id` property is a `GUID` and is generated by the database by default. You can change the `id` property to be an `int` or `bigint` and set it to `IDENTITY` to be auto-incremented by the database.
> The `id` property in the sample response above is just a sample value and not the actual value that you'll get from the API.

** documentation in progress - more examples to be added soon **